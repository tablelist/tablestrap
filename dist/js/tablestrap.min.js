angular.module("tablestrap",[]),angular.module("tablestrap").directive("schedulePicker",["$parse",function(){return{restrict:"E",require:"ngModel",scope:{ngModel:"="},template:'<div class="schedule-picker clearfix"><div class="schedule-day clearfix" ng-repeat="scheduleDay in scheduleDays"><label><input type="checkbox" ng-checked="!scheduleDay.closed" ng-click="scheduleDay.select()"><span class="scheduleDay-name">{{ getDayFromNumber(scheduleDay.day) }}</span></label><div class="time-picker-range" ng-repeat="hoursRange in scheduleDay.hours"><div class="time-picker start-time" ng-class="{ error: hoursRange.invalidStartTime }"><select class="time-select" ng-model="hoursRange.startTime"><option ng-repeat="time in times" value="{{time}}">{{time}}</option></select><div class="meridian"><select ng-model="hoursRange.startMeridian" ng-options="period as period.name for period in periods"></select><i class="fa fa-chevron-down"></i></div></div><div class="splitter">-</div><div class="time-picker end-time" ng-class="{ error: hoursRange.invalidEndTime }"><select class="time-select" ng-model="hoursRange.endTime"><option ng-repeat="time in times" value="{{time}}">{{time}}</option></select><div class="meridian"><select ng-model="hoursRange.endMeridian" ng-options="period as period.name for period in periods"></select><i class="fa fa-chevron-down"></i></div></div><a class="time-picker-remove" href="#" ng-click="scheduleDay.removeHours($index)"><i class="fa fa-times"></i></a><div class="time-picker-disabled" ng-show="scheduleDay.closed" ng-click="scheduleDay.select()"></div></div><a class="time-picker-add" href="#" ng-click="scheduleDay.addHours()" ng-hide="scheduleDay.closed"><i class="fa fa-plus"></i></a></div></div>',link:function(e,i,s,a){function n(i){this.day=i,this.closed=!0,this.hours=[{startTime:null,startMeridian:e.periods[0],endTime:null,endMeridian:e.periods[1]}]}function r(e){var i=s.required;return i&&!e?a.$setValidity("required",!1):a.$setValidity("required",!0),t(),e}function t(){var i,s,n,r,t;for(i=0;i<e.scheduleDays.length;i++){var l=e.scheduleDays[i];if(l.validate(),!l.closed){if(!(l.closed||l.hours&&l.hours.length)){n=!0;break}if(l.hours&&l.hours.length)for(s=0;s<l.hours.length;s++){var d=l.hours[s];if(!(l.closed||d.startTime&&d.endTime)){n=!0,r=!0,t=!0;break}d.start=d.startTime+" "+d.startMeridian.name,d.end=d.endTime+" "+d.endMeridian.name}}}n?a.$setValidity("invalidRange",!1):a.$setValidity("invalidRange",!0),r?a.$setValidity("invalidStartTime",!1):a.$setValidity("invalidStartTime",!0),t?a.$setValidity("invalidEndTime",!1):a.$setValidity("invalidEndTime",!0)}e.periods=[{name:"AM"},{name:"PM"}],e.times=["12:00","12:30","1:00","1:30","2:00","2:30","3:00","3:30","4:00","4:30","5:00","5:30","6:00","6:30","7:00","7:30","8:00","8:30","9:00","9:30","10:00","10:30","11:00","11:30"],n.prototype.addHours=function(){var i=this;i.closed=!1,i.hours.push({startTime:null,startMeridian:e.periods[0],endTime:null,endMeridian:e.periods[1]})},n.prototype.select=function(){var e=this;e.closed?(e.closed=!1,e.reset()):e.closed=!0},n.prototype.removeHours=function(e){var i=this;1===i.hours.length?i.closed=!0:i.hours.splice(e,1),i.validate()},n.prototype.reset=function(){var e=this;e.hours=[],e.addHours()},n.prototype.validate=function(){var e=this;if(e.hours&&e.hours.length)for(var i=0;i<e.hours.length;i++){var s=e.hours[i];e.closed?(s.invalidStartTime=!1,s.invalidEndTime=!1,s.invalidRange=!1,s.startTime&&(s.startTime=null),s.endTime&&(s.endTime=null)):(s.invalidStartTime=s.startTime?!1:!0,s.invalidEndTime=s.endTime?!1:!0,s.invalidRange=s.invalidStartTime&&s.invalidEndTime?!0:!1)}},e.scheduleDays=[new n(1),new n(2),new n(3),new n(4),new n(5),new n(6),new n(0)],e.getDayFromNumber=function(e){switch(e){case 0:return"Sun";case 1:return"Mon";case 2:return"Tue";case 3:return"Wed";case 4:return"Thur";case 5:return"Fri";case 6:return"Sat";default:throw new Error("invalid day :"+e)}},e.$watch("scheduleDays",function(e){a.$setViewValue(e)},!0),a.$parsers.unshift(function(e){return console.log("parsers running..."),r(e),e}),a.$formatters.push(function(i){if(console.log("formaters running..."),console.log(i),i&&i.length)for(var s=0;s<i.length;s++){var a=i[s];console.log("current"),console.log(r);var n=0===a.day?6:a.day-1,r=e.scheduleDays[n];r&&(r.closed=a.closed),console.log("scheduleDay"),console.log(r)}return i})}}}]);